<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Last Letter Manifesto</title>
<link rel="icon" href="https://kcmo.xyz/favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
   body {
    font-family: 'Noto Sans Mono', monospace;
    margin: 12px;
    background-color: #c0c0c0;
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    box-sizing: border-box;
}

.page {
    background-color: #ffc0c0;
    border: 1px solid rgba(48, 48, 48, 0.3);
    border-radius: 12px;
    box-shadow: -4px 4px 4px rgba(48, 48, 48, 0.3);
    padding: 16px;
    margin: 0 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

#signature-canvas {
  border: 1px solid #30FFCF;
}

#gallery {
  max-height: 300px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;
}

.container {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    width: 90%;
    max-width: 600px;
    box-sizing: border-box;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
    font-stretch: extra-expanded;
    line-height: 1.2;
}

label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}

input[type="text"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    box-sizing: border-box;
}

.color-swatch {
    width: 20px;
    height: 20px;
    display: inline-block;
    border: 1px solid #000;
    cursor: pointer;
}

button {
    background-color: #007BFF;
    color: #fff;
    border: none;
    padding: 10px 15px;
    border-radius: 5px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #0056b3;
}

.submission {
    border: 1px solid #ccc;
    padding: 10px;
    text-align: center;
    border-radius: 5px;
}

.submission img {
    max-width: 100%;
    height: auto;
}

</style>
</head>
<body>
<div class="page">
  <h1>The Last Letter Manifesto</h1>

  <div id="submission-container">
    <form id="submission-form" method="POST" action="https://sig-laborer.jojo-829.workers.dev/">
      <h2>Add your Signature</h2>

      <label for="name">Your Name (optional):</label>
      <input type="text" id="name" name="name" placeholder="Enter your name">

      <label for="color">Choose your ink color:</label>
      <div id="color-picker">
        <input type="radio" id="color-red" name="color" value="red" checked>
        <label id="red" for="color-red" class="color-swatch"></label>

        <input type="radio" id="color-blue" name="color" value="blue">
        <label id="blue" for="color-blue" class="color-swatch"></label>

        <input type="radio" id="color-green" name="color" value="green">
        <label id="green" for="color-green" class="color-swatch"></label>

        <input type="radio" id="color-black" name="color" value="black">
        <label id="black" for="color-black" class="color-swatch"></label>
      </div>

      <label for="mark">Your Mark/Signature (optional):</label>
      <canvas id="signature-canvas" width="256" height="128"></canvas>
      <input type="hidden" id="mark" name="mark">
      <button type="button" id="clear-canvas">Clear</button>

      <label for="agreement">
        <input type="checkbox" id="agreement" name="agreement" required>
        I second the demands, and support the objectives of this document.
      </label>

      <button type="submit">Submit</button>
    </form>

    <div id="gallery-container">
      <h2>Total Signatures: <span id="submission-counter">0</span></h2>
      <div id="gallery"></div>
    </div>
  </div>
</div>

<script>
  const canvas = document.getElementById('signature-canvas');
  const ctx = canvas.getContext('2d');
  const markInput = document.getElementById('mark');
  const galleryContainer = document.getElementById('gallery');
  const submissionCounter = document.getElementById('submission-counter');

  let drawing = false;

  canvas.addEventListener('mousedown', () => drawing = true);
  canvas.addEventListener('mouseup', () => {
    drawing = false;
    ctx.beginPath();
    markInput.value = canvas.toDataURL('image/png');
  });

  canvas.addEventListener('mousemove', draw);

  function draw(event) {
    if (!drawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = 'round';
    ctx.strokeStyle = document.querySelector('input[name="color"]:checked').value;

    const rect = canvas.getBoundingClientRect();
    ctx.lineTo(event.clientX - rect.left, event.clientY - rect.top);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(event.clientX - rect.left, event.clientY - rect.top);
  }

  document.getElementById('clear-canvas').addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    markInput.value = '';
  });

  async function fetchGallery() {
    try {
      const response = await fetch('https://sig-laborer.jojo-829.workers.dev/gallery');
      const data = await response.json();

      submissionCounter.textContent = data.counter;
      galleryContainer.innerHTML = '';

      data.submissions.forEach(submission => {
        const item = document.createElement('div');
        item.classList.add('submission');
        item.innerHTML = `
          <p>Name: ${submission.name || 'None given'}</p>
          ${submission.mark ? `<img src="${submission.mark}" alt="Mark">` : '<p>No mark provided.</p>'}
        `;
        galleryContainer.appendChild(item);
      });
    } catch (error) {
      console.error('Error fetching gallery:', error);
    }
  }

  document.getElementById('submission-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value.trim() || 'Anonymous';
    const agreement = document.getElementById('agreement').checked;

    if (!agreement) {
      alert('Please check the box to submit.');
      return;
    }

    const payload = {
      name,
      mark: markInput.value || null,
      agreement,
    };

    const response = await fetch('https://sig-laborer.jojo-829.workers.dev/', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload),
    });

    if (response.ok) {
      alert('Submission successful! For inquiries or insults, email us.');
      fetchGallery();
    } else {
      alert('Error submitting form.');
    }
  });

  fetchGallery();
</script>
</body>
</html>
